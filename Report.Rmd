---
title: "`r paste0('Data-driven ecosystems of ',aoiFullName)`"
subtitle: "`r paste0('[',substr(as.data.frame(git2r::repository())[1,1],1,7),'] ',as.data.frame(git2r::repository())[1,2])`"
author:
- Department for Environment and Water
date: "`r format(Sys.time(), '%A, %d %B, %Y. %H:%M')`"
output:
  bookdown::word_document2:
    toc: no
    toc_depth: 3
    reference_docx:           common/Styles.docx
    fig_caption: yes
link-citations: no
csl:                          common/BibStyle.csl
bibliography:                 [common/refs.bib,packageRefs.bib]
---


# Setup code

```{r setup, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

  library("timeR")
  reportTimer <- createTimer(precision = "ms"
                             , verbose = FALSE
                             )
  
  reportTimer$start("report")

  if(!exists("packages")) source("0005_setup.R")
  
  knitcitations::cleanbib()
  options("citation_format" = "pandoc")

```

# Import

```{r importTaxa}

  if(!exists("taxaAll")) source("0010_import_taxa.R")

```

Total records: `r format(nrow(taxaAll),big.mark = ",")`.

# Tidy

```{r tidy}

  if(!exists("dat")) source("0020_tidy.R")

```

Area of interest: `r aoiFullName`, defined by `r vec_to_sentence(aoiName)` IBRA Subregions.

Total tidied records: `r format(nrow(dat),big.mark=",")`.

# Analysis

```{r analysis}

  if(!exists("taxaModsFull")) source("0030_Analysis.R")

```

```{r include=FALSE}

  taxaExp = NULL

  taxaLoop <- taxaModsFull$Taxa %>%
    {if(testRmd) sample(.,3) else .} %>%
    gsub(" ","",.)
    

  for (i in taxaLoop) {
    
    thisTaxa <- i
    
    taxaExp = c(taxaExp, knit_expand('child/taxaSummary.Rmd'))
    
  }

```

`r paste(knit(text = taxaExp), collapse = '\n')`

# Appendix

## Run times

Table \@ref(tab:runtimes) shows the time taken to run this report, and import, tidy, model and visualise the data presented.

```{r runtimes}

  reportTimer$stop("report", comment = "creation of .docx from .rmd")

  kable(read_feather(path(outDir,"timer.feather")) %>%
          #dplyr::bind_rows(read_feather(path("out","extractTimer.feather"))) %>%
          dplyr::bind_rows(getTimer(reportTimer)) %>%
          dplyr::mutate(timeElapsed = round(timeElapsed,1))
        , caption = "Timing of the various components that make up this report"
        )

```

# References
